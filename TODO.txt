NOTES and TODOS about Cairo and OOFCanvas


In Cairo, drawing needs to be done inside the callback for the gtk
expose_event.

Adding a CanvasItem to a Canvas or layer adds it to the Canvas or
layer's list of items.  Each item can compute its bounding box in
user coordinates, but some might need to know the canvas's ppu in
order to do so.

In the expose event's callback:
  Get the exposed rectangle (GdkRectangle GdkExposeEvent::area)
  Convert rectangle to physical coordinates
  Loop over all layers from bottom to top:
     Loop over all items in layer from first to last:
        If item's bbox intersects exposed bounding box in physical coords:
	    Draw item
	    
Each layer has its own Cairo Surface.  Each draws to its own
Surface and the Surfaces are then drawn with appropriate masks and
transparency to the final Surface (belonging to the gtk Layout).

Adding a CanvasItem to a CanvasLayer does not automatically draw it on the
layer.  It can't be drawn until the layer's Cairo::Surface is created,
and that can't be created until all layers' bounding boxes are known.
Bounding boxes depend on all the items in the Layer as well as the
ppu.  So CanvasItems need to be able to compute their bounding boxes
before CanvasItem::draw is called, but after the ppu is known.

CanvasLayer::dirty indicates that a layer needs to redraw itself to
its Surface.  Adding a CanvasItem to a layer automatically sets
dirty=true, but (TODO) it needs to be set manually if an item's parameters
change after it's been added to a layer.

---

Mouse clicks:

* Each CanvasItem knows its bounding box and can say whether a mouse
  click at a particular user coordinate hits it.

* Each CanvasLayer has a set of bins and knows which CanvasItems'
  bounding boxes overlap each bin.  Or use an R-tree?

* Given a mouse click position, compute which bin it's in (or bins, if
  on a boundary), find the CanvasItems whose bounding boxes overlap
  the bin(s), and ask each CanvasItem if the click hits them.  Return
  a list of CanvasItems.

---

Don't assume that Python exists...  Don't call initializePyGTK or
PyGILState_Ensure/PyGILState_Release unless PYOOFCANVAS is defined.
Also don't run swig if it's not defined.

Do we want to support different scales in the x and y directions?
CanvasDot and CanvasLayer::pixel2user(double) assume that the scales
are the same.

---

Use Pango instead of Cairo::ToyFontFace?  Seems like a lot of work.

Define CanvasGroup to allow a combination of objects to be defined and
duplicated at different positions and scales?

Instead of a separate non-scaled triangle class for arrowheads, make
arrowheads an option on the CanvasSegment.  Then the direction can be
inferred from the segment direction.  The head can be scaled or not,
like CanvasText.

Should objects be changeable?  When an object is added, removed, or
changed, should the layer be told so that just some part of it can be
updated?  Or is Cairo already taking care of all that for us?

Should default values for parameters be settable?  After calling
CanvasText::setFont, should the next text item created automatically
use the same font?
